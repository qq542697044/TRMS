{"remainingRequest":"E:\\Github\\code\\TRMS\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Github\\code\\TRMS\\src\\views\\User\\module\\resc.vue?vue&type=style&index=0&id=4a5c787c&lang=scss&scoped=true&","dependencies":[{"path":"E:\\Github\\code\\TRMS\\src\\views\\User\\module\\resc.vue","mtime":1585155776059},{"path":"E:\\Github\\code\\TRMS\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Github\\code\\TRMS\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\Github\\code\\TRMS\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\Github\\code\\TRMS\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Github\\code\\TRMS\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Github\\code\\TRMS\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5jb250cm9sLWJveCB7DQogIG1hcmdpbi1ib3R0b206IDVweDsNCn0NCi5jYXJkLWJveCB7DQogIG1hcmdpbjogNXB4Ow0KfQ0KLmNlbnRlciB7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCg=="},{"version":3,"sources":["resc.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6dA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"resc.vue","sourceRoot":"src/views/User/module","sourcesContent":["<template>\r\n  <div id=\"resc-mobiler\">\r\n    <div class=\"control-box\">\r\n      <el-button type=\"primary\" icon=\"el-icon-edit\" circle @click=\"addDialogOpen\"></el-button>\r\n      <el-button type=\"primary\" icon=\"el-icon-turn-off\" circle @click=\"showSelect\"></el-button>\r\n      <div\r\n        class=\"control-box-svg\"\r\n        style=\"display:inline-block;vertical-align:bottom;margin-left:5px;\"\r\n      >\r\n        <span @click=\"showSelect('normal')\">\r\n          <svg-icon\r\n            iconClass=\"res_normal\"\r\n            class=\"res_normal\"\r\n            style=\"font-size:30px;padding:0 10px;\"\r\n          />\r\n        </span>\r\n        <span @click=\"showSelect('error')\">\r\n          <svg-icon iconClass=\"res_error\" class=\"res_error\" style=\"font-size:30px;padding:0 10px;\" />\r\n        </span>\r\n      </div>\r\n    </div>\r\n    <el-divider content-position=\"right\">资源列表</el-divider>\r\n    <ul\r\n      class=\"infinite-list\"\r\n      v-infinite-scroll=\"load\"\r\n      style=\"overflow:auto\"\r\n      infinite-scroll-disabled=\"disabled\"\r\n    >\r\n      <li v-for=\"(item,index) in showData.item\" :key=\"index\">\r\n        <div class=\"float-left card-box\">\r\n          <el-card\r\n            :body-style=\"{ padding: '0px',width:'250px',border:'solid 1px #f0f0f0'}\"\r\n            shadow=\"hover\"\r\n          >\r\n            <div style=\"padding: 14px;\">\r\n              <h3 style=\"display:inline\">资源-{{index+1}}</h3>\r\n              <svg-icon\r\n                iconClass=\"res_error\"\r\n                class=\"res_error float-right\"\r\n                style=\"font-size:30px;\"\r\n                v-if=\"item.state=='故障'\"\r\n              />\r\n              <svg-icon\r\n                iconClass=\"res_normal\"\r\n                class=\"res_normal float-right\"\r\n                style=\"font-size:30px;\"\r\n                v-if=\"item.state=='正常'\"\r\n              />\r\n              <div>\r\n                <el-form label-position=\"left\" inline class=\"demo-table-expand\">\r\n                  <el-form-item label=\"编号\">\r\n                    <span>{{ item.id }}</span>\r\n                  </el-form-item>\r\n                  <br />\r\n                  <el-form-item label=\"类型\">\r\n                    <span>{{ item.type }}</span>\r\n                  </el-form-item>\r\n                  <br />\r\n                  <el-form-item label=\"状态\">\r\n                    <span :style=\"item.state=='故障'? 'color:red':''\">{{ item.state }}</span>\r\n                  </el-form-item>\r\n                  <br />\r\n                  <el-form-item label=\"地址\">\r\n                    <span>{{ item.address }}</span>\r\n                  </el-form-item>\r\n                  <br />\r\n                  <el-form-item label=\"供应商\">\r\n                    <span>{{ item.supplier }}</span>\r\n                  </el-form-item>\r\n                </el-form>\r\n              </div>\r\n\r\n              <div class=\"bottom clearfix\">\r\n                <el-button type=\"text\" class=\"button\" @click=\"dialogOpen(index)\">编辑</el-button>\r\n                <el-button type=\"text\" class=\"button\" @click=\"deleteRes(index)\">删除</el-button>\r\n              </div>\r\n            </div>\r\n          </el-card>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n    <p class=\"center\" v-if=\"pageControl.loading\">加载中...</p>\r\n    <p class=\"center\" v-if=\"pageControl.error\">加载失败</p>\r\n    <p class=\"center\" v-if=\"noMore\">没有更多了</p>\r\n    <div style=\"height:60px\"></div>\r\n\r\n    <el-dialog title=\"新增资源\" :visible.sync=\"addDialog.visible\" width=\"380px\">\r\n      <div class=\"demo-drawer__content\">\r\n        <el-form :model=\"addDialog.form\" class=\"add-form\">\r\n          <el-form-item label=\"编号\" :label-width=\"dialogForm.formLabelWidth\">\r\n            <el-input v-model=\"addDialog.form.id\" autocomplete=\"off\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"类别\" :label-width=\"dialogForm.formLabelWidth\">\r\n            <el-select v-model=\"addDialog.form.type\" placeholder=\"请选择类别\" filterable allow-create>\r\n              <el-option\r\n                v-for=\"item in options_type.item\"\r\n                :key=\"item.value\"\r\n                :label=\"item.label\"\r\n                :value=\"item.value\"\r\n              ></el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item label=\"地址\" :label-width=\"dialogForm.formLabelWidth\">\r\n            <el-input v-model=\"addDialog.form.address\" :disabled=\"'true'=='true'\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"供应商\" :label-width=\"dialogForm.formLabelWidth\">\r\n            <el-select\r\n              v-model=\"addDialog.form.supplier\"\r\n              placeholder=\"请选择供应商\"\r\n              filterable\r\n              allow-create\r\n            >\r\n              <el-option\r\n                v-for=\"item in options_supp.item\"\r\n                :key=\"item.value\"\r\n                :label=\"item.label\"\r\n                :value=\"item.value\"\r\n              ></el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item label=\"状态\" :label-width=\"dialogForm.formLabelWidth\">\r\n            <el-select v-model=\"addDialog.form.state\" placeholder=\"请选择资源状态\">\r\n              <el-option label=\"正常\" value=\"正常\"></el-option>\r\n              <el-option label=\"故障\" value=\"故障\"></el-option>\r\n            </el-select>\r\n          </el-form-item>\r\n          <el-form-item label=\"备注\" :label-width=\"dialogForm.formLabelWidth\">\r\n            <el-input\r\n              type=\"textarea\"\r\n              maxlength=\"45\"\r\n              show-word-limit\r\n              v-model=\"addDialog.form.notice\"\r\n              autocomplete=\"off\"\r\n            ></el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div class=\"demo-drawer__footer\">\r\n          <el-button @click=\"addDialog.visible=false\">取 消</el-button>\r\n          <el-button type=\"primary\" @click=\"addRes\" :loading=\"addDialog.loading\">\r\n            {{\r\n            addDialog.loading ? \"提交中 ...\" : \"确 定\"\r\n            }}\r\n          </el-button>\r\n        </div>\r\n      </div>\r\n    </el-dialog>\r\n\r\n    <el-dialog title=\"资源信息更新\" :visible.sync=\"dialogForm.dialogFormVisible\" width=\"380px\">\r\n      <el-form :model=\"dialogForm.form\">\r\n        <el-form-item label=\"编号\" :label-width=\"dialogForm.formLabelWidth\">\r\n          <el-input v-model=\"dialogForm.form.id\" autocomplete=\"off\" :disabled=\"'true'=='true'\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"类型\" :label-width=\"dialogForm.formLabelWidth\">\r\n          <el-select v-model=\"dialogForm.form.restype\" allow-create filterable>\r\n            <el-option\r\n              v-for=\"item in options_type.item\"\r\n              :key=\"item.id\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            ></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"供应商\" :label-width=\"dialogForm.formLabelWidth\">\r\n          <el-select v-model=\"dialogForm.form.supplier\" allow-create filterable>\r\n            <el-option\r\n              v-for=\"item in options_supp.item\"\r\n              :key=\"item.id\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            ></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"状态\" :label-width=\"dialogForm.formLabelWidth\">\r\n          <el-select v-model=\"dialogForm.form.resState\">\r\n            <el-option label=\"正常\" value=\"正常\"></el-option>\r\n            <el-option label=\"故障\" value=\"故障\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogForm.dialogFormVisible = false\">取 消</el-button>\r\n        <el-button type=\"danger\" @click=\"editRes\">确 定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { getuserLoc } from \"@/utils/cookie\";\r\nimport { ref, onMounted, reactive, computed } from \"@vue/composition-api\";\r\nexport default {\r\n  name: \"resc-mobile\",\r\n  setup(props, { root }) {\r\n    //测试用\r\n    const Test = () => {\r\n      console.log(resData.item[[1]]);\r\n    };\r\n    //正常/故障筛选\r\n    const showData = reactive({\r\n      item: []\r\n    });\r\n    const showSelect = state => {\r\n      if (state == \"normal\") {\r\n        showData.item = [];\r\n        resData.item.forEach(item => {\r\n          if (item.state == \"正常\") {\r\n            showData.item.push(item);\r\n          }\r\n        });\r\n      } else if (state == \"error\") {\r\n        showData.item = [];\r\n        resData.item.forEach(item => {\r\n          if (item.state == \"故障\") {\r\n            showData.item.push(item);\r\n          }\r\n        });\r\n      } else {\r\n        showData.item = [];\r\n        resData.item.forEach(item => {\r\n          showData.item.push(item);\r\n        });\r\n      }\r\n    };\r\n\r\n    const clearSort = () => {\r\n      options_type.item = [];\r\n      options_addr.item = [];\r\n      options_supp.item = [];\r\n    };\r\n    //分类选项\r\n    const options_type = reactive({\r\n      item: []\r\n    });\r\n    //供应商选项\r\n    const options_supp = reactive({\r\n      item: []\r\n    });\r\n    const getSortInfo = () => {\r\n      root.$store\r\n        .dispatch(\"resc/get_sort_info\")\r\n        .then(response => {\r\n          let data = response.data.data;\r\n          data.resType.forEach(item => {\r\n            options_type.item.push({\r\n              value: item.typeName,\r\n              label: item.typeName\r\n            });\r\n          });\r\n          data.supplier.forEach(item => {\r\n            options_supp.item.push({\r\n              value: item.supplierName,\r\n              label: item.supplierName\r\n            });\r\n          });\r\n        })\r\n        .catch(error => {});\r\n    };\r\n    //资源数据\r\n    const resData = reactive({\r\n      item: []\r\n    });\r\n    \r\n    //无限滑动窗口\r\n    const currentPage = ref(1);\r\n    const pageSize = ref(10);\r\n    const total = ref(1);\r\n    const pageControl = reactive({\r\n      count: 0,\r\n      loading: false,\r\n      error: false\r\n    });\r\n    const noMore = computed(() => pageControl.count >= total.value);\r\n\r\n    const disabled = computed(() => pageControl.loading || noMore.value);\r\n    const load = () => {\r\n      pageControl.loading = true;\r\n      currentPage.value += 1;\r\n      queryRes();\r\n      setTimeout(() => {}, 2000);\r\n    };\r\n\r\n    //查询\r\n    const search_form = reactive({\r\n      type: \"\",\r\n      addr: getuserLoc(),\r\n      supplier: \"\",\r\n      id: \"\"\r\n    });\r\n    const queryRes = () => {\r\n      let requestData = {\r\n        type: search_form.type,\r\n        address: search_form.addr,\r\n        supplier: search_form.supplier,\r\n        id: search_form.id,\r\n        pageNumber: currentPage.value,\r\n        pageSize: pageSize.value\r\n      };\r\n      root.$store\r\n        .dispatch(\"resc/query_resource\", requestData)\r\n        .then(response => {\r\n          let Data = response.data.data.data;\r\n          /*返回时间数据格式处理 */\r\n          // resData.forEach(item=>{\r\n          //   item.createdDate=；\r\n          //   item.modifiedDate=;\r\n          // })\r\n          resData.item = Data;\r\n          showData.item = Data;\r\n          total.value = response.data.data.total;\r\n          pageControl.count += pageSize.value;\r\n          pageControl.loading = false;\r\n          pageControl.error = false;\r\n          console.log(noMore.value);\r\n          console.log(disabled.value);\r\n        })\r\n        .catch(error => {\r\n          pageControl.loading = false;\r\n          pageControl.error = true;\r\n        });\r\n    };\r\n    //新增资源弹窗\r\n    const addDialog = reactive({\r\n      form: {\r\n        id: \"\",\r\n        type: \"\",\r\n        state: \"\",\r\n        address: getuserLoc(),\r\n        supplier: \"\",\r\n        notice: \"\"\r\n      },\r\n      visible: false,\r\n      loading: false,\r\n      timer: null\r\n    });\r\n\r\n    const addDialogOpen = () => {\r\n      addDialog.visible = true;\r\n    };\r\n\r\n    const addRes = done => {\r\n      if (addDialog.loading) {\r\n        return;\r\n      } else if (addDialog.form.id != \"\") {\r\n        root\r\n          .$confirm(\"确定新增或更新资源吗？\")\r\n          .then(_ => {\r\n            addDialog.loading = true;\r\n            addDialog.timer = setTimeout(() => {\r\n              let requestData = {\r\n                id: addDialog.form.id,\r\n                restype: addDialog.form.type,\r\n                address: addDialog.form.address,\r\n                supplier: addDialog.form.supplier,\r\n                resState: addDialog.form.state,\r\n                resNotice: addDialog.form.notice\r\n              };\r\n              //新增资源请求函数\r\n              root.$store\r\n                .dispatch(\"resc/add_resource\", requestData)\r\n                .then(response => {\r\n                  addDialog.visible = false;\r\n                  queryRes();\r\n                  clearSort();\r\n                  getSortInfo();\r\n                })\r\n                .catch(error => {});\r\n              // 动画关闭需要一定的时间\r\n              setTimeout(() => {\r\n                addDialog.loading = false;\r\n              }, 400);\r\n            }, 1000);\r\n          })\r\n          .catch(_ => {});\r\n      } else {\r\n        addDialog.visible = false;\r\n        addDialog.loading = false;\r\n      }\r\n    };\r\n\r\n    //编辑资源信息\r\n    //弹窗表单\r\n    const dialogForm = reactive({\r\n      dialogFormVisible: false,\r\n      form: {\r\n        id: \"\",\r\n        restype: \"\",\r\n        supplier: \"\",\r\n        resState: \"\"\r\n      },\r\n      currentIndex: 0,\r\n      formLabelWidth: \"60px\"\r\n    });\r\n\r\n    const dialogOpen = index => {\r\n      dialogForm.dialogFormVisible = true;\r\n      dialogForm.form.id = resData.item[index].id;\r\n      dialogForm.form.restype = resData.item[index].type;\r\n      dialogForm.form.supplier = resData.item[index].supplier;\r\n      dialogForm.form.resState = resData.item[index].state; //如果直接写为dialogForm.form=resData.item[index]会使form直接指向resData.item[index]的内存地址（绑定为同一对象），此时修改form会导致resData被修改\r\n      dialogForm.currentIndex = index;\r\n    };\r\n\r\n    const editRes = () => {\r\n      let date = new Date();\r\n      let editData = dialogForm.form;\r\n      editData.address = getuserLoc();\r\n      editData.resNotice = date.toString() + \"更新\";\r\n      root.$store\r\n        .dispatch(\"resc/update_resource\", editData)\r\n        .then(response => {\r\n          dialogForm.dialogFormVisible = false;\r\n          queryRes();\r\n          console.log(\"更新成功\");\r\n        })\r\n        .catch(error => {});\r\n    };\r\n    //删除资源\r\n    const deleteRes = index => {\r\n      root\r\n        .$confirm(\"此操作将永久删除该资源, 是否继续?\", \"提示\", {\r\n          confirmButtonText: \"确定\",\r\n          cancelButtonText: \"取消\",\r\n          type: \"warning\"\r\n        })\r\n        .then(() => {\r\n          root.$store\r\n            .dispatch(\"resc/delete_resource\", { ids: [resData.item[index].id] })\r\n            .then(response => {\r\n              root.$message({\r\n                type: \"success\",\r\n                message: \"删除成功\"\r\n              });\r\n              resData.item.pop(index);\r\n            })\r\n            .catch(error => {\r\n              root.$message({\r\n                type: \"error\",\r\n                message: \"删除失败，请联系管理员\"\r\n              });\r\n            });\r\n        })\r\n        .catch(() => {\r\n          root.$message({\r\n            type: \"info\",\r\n            message: \"已取消删除\"\r\n          });\r\n        });\r\n    };\r\n\r\n    onMounted(() => {\r\n      getSortInfo();\r\n    });\r\n    return {\r\n      noMore,\r\n      disabled,\r\n      //ref\r\n      options_type,\r\n      options_supp,\r\n      //reactive\r\n      showData,\r\n      pageControl,\r\n      dialogForm,\r\n      addDialog,\r\n      //methods\r\n      load,\r\n      showSelect,\r\n      dialogOpen,\r\n      editRes,\r\n      deleteRes,\r\n      addDialogOpen,\r\n      addRes,\r\n\r\n      Test\r\n    };\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.control-box {\r\n  margin-bottom: 5px;\r\n}\r\n.card-box {\r\n  margin: 5px;\r\n}\r\n.center {\r\n  text-align: center;\r\n}\r\n</style>"]}]}